<div class="spinner-overlay" *ngIf="loading">
  <div class="spinner">
    <mat-spinner></mat-spinner>
  </div>
</div>
<app-navigation>
  <br><br>

  <div class="container">
    <form [formGroup]="newForm" (ngSubmit)="postForm(newForm.value)">
      <div class="row">
        <div class="col">
          <div class="form-group">
            <label for="exampleFormControlInput1">Nombre Rol <b style="color: red;">*</b></label>
            <input type="text" class="form-control" formControlName="nombreRol"
              [class.is-invalid]="newForm.get('nombreRol')?.invalid && newForm.get('nombreRol')?.touched" />
          </div>
        </div>
      </div>
      <br><br><br>

      <h2>Permisos</h2><br><br>
      <div class="row">
        <div class="col">
          <input type="checkbox" (change)="updateCheckboxes('listar-', $event)">
          <strong>LISTAR</strong><br><br>
          <div formArrayName="permisosSeleccionados">
            <ng-container *ngFor="let permiso of permisos; let i = index">
              <div *ngIf="permiso?.nombrePermiso?.startsWith('listar-')">
                <label>
                  <input type="checkbox" [formControlName]="i">
                  {{ permiso?.nombrePermiso }}
                </label>
              </div>
            </ng-container>
          </div>
        </div>
        <div class="col">
          <input type="checkbox" (change)="updateCheckboxes('crear-', $event)" />
          <strong>CREAR</strong><br><br>
          <div formArrayName="permisosSeleccionados">
            <ng-container *ngFor="let permiso of permisos; let i = index">
              <div *ngIf="permiso?.nombrePermiso?.startsWith('crear-')">
                <label>
                  <input type="checkbox" [formControlName]="i">
                  {{ permiso?.nombrePermiso }}
                </label>
              </div>
            </ng-container>
          </div>
        </div>

        <div class="col">
          <input type="checkbox" (change)="updateCheckboxes('editar-', $event)">
          <strong>EDITAR</strong><br><br>
          <div formArrayName="permisosSeleccionados">
            <ng-container *ngFor="let permiso of permisos; let i = index">
              <div *ngIf="permiso?.nombrePermiso?.startsWith('editar-')">
                <label>
                  <input type="checkbox" [formControlName]="i">
                  {{ permiso?.nombrePermiso }}
                </label>
              </div>
            </ng-container>
          </div>
        </div>
        <div class="col">
          <input type="checkbox" (change)="updateCheckboxes('eliminar-', $event)">
          <strong>ELIMINAR</strong><br><br>
          <div formArrayName="permisosSeleccionados">
            <ng-container *ngFor="let permiso of permisos; let i = index">
              <div *ngIf="permiso?.nombrePermiso?.startsWith('eliminar-')">
                <label>
                  <input type="checkbox" [formControlName]="i">
                  {{ permiso?.nombrePermiso }}
                </label>
              </div>
            </ng-container>
          </div>
        </div>
      </div>

      <br><br>

      <label>
        <input type="checkbox" (change)="updateAllCheckboxes($event)">
        Seleccionar todos los permisos
      </label>

      <br><br>

      <button type="button" mat-raised-button color='accent' (click)="goBack()">Atras</button> |
      <button type="submit" mat-raised-button color='primary' [disabled]="newForm.invalid">Guardar</button>

    </form>
  </div>
</app-navigation>